# Блок-схема ASCII: Запуск опроса (временно без проверок)

## 📊 Общая схема процесса (ASCII)

```
┌─────────────────────────────────────────────────────────────────┐
│                    ФРОНТЕНД                                    │
└─────────────────────┬───────────────────────────────────────────┘
                      │ POST /api/surveys/{id}/start/
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    BACKEND                                     │
└─────────────────────┬───────────────────────────────────────────┘
                      │ Получение запроса
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│              Получение объекта Survey по ID                    │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
              ┌───────────────┐
              │ Survey        │
              │ существует?   │
              └───────┬───────┘
                      │
            ┌─────────┴─────────┐
            │                    │
            ▼                    ▼
    ┌─────────────┐    ┌─────────────────┐
    │     НЕТ     │    │       ДА        │
    │ Ошибка 404  │    │ Продолжить      │
    └─────────────┘    └─────────┬───────┘
                                 │
                                 ▼
              ┌─────────────────────────────────┐
              │    Получение параметров        │
              │      из request.data           │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │ questions_count = request.data  │
              │ .questions_count ||             │
              │ survey.questions_count          │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │ language = request.data.language│
              │ || 'uz'                        │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │      Начало транзакции БД      │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │  Поиск последней попытки       │
              │      пользователя              │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │  Вычисление номера следующей   │
              │         попытки                │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │   Создание новой сессии        │
              │      SurveySession             │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │   Инициализация вопросов       │
              │      для сессии                │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │  Обновление статуса сессии     │
              │      на 'in_progress'          │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │ Создание/обновление истории    │
              │      пользователя              │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │    Завершение транзакции БД    │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │  Возврат данных сессии +       │
              │      статус 201                │
              └─────────────────┬───────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ФРОНТЕНД                                    │
│              Получение ответа                                 │
└───────────────────────────────────────────────────────────────┘
```

## 🔄 Детальная схема создания сессии (ASCII)

```
┌─────────────────────────────────────────────────────────────────┐
│                    Создание сессии                             │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
              ┌─────────────────────────────────┐
              │        Параметры сессии        │
              └─────────────────┬───────────────┘
                                │
            ┌───────────────────┼───────────────────┐
            │                   │                   │
            ▼                   ▼                   ▼
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │    user     │    │   survey    │    │attempt_number│
    │request.user │    │полученный   │    │last_attempt+1│
    └─────────────┘    │   объект    │    └─────────────┘
            │          └─────────────┘            │
            │                   │                 │
            └───────────────────┼─────────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │   SurveySession.objects.create  │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │      Инициализация вопросов    │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │ questions_count = из запроса   │
              │ или survey.questions_count     │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │  session.initialize_questions  │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │  Обновление статуса на          │
              │      'in_progress'             │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │      Сохранение сессии         │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │  Обновление истории             │
              │      пользователя              │
              └─────────────────┬───────────────┘
                                │
                                ▼
              ┌─────────────────────────────────┐
              │        Возврат сессии          │
              └─────────────────────────────────┘
```

## 📝 Схема обработки параметров (ASCII)

```
┌─────────────────────────────────────────────────────────────────┐
│                    request.data                                │
└─────────────────────┬───────────────────────────────────────────┘
                      │
            ┌─────────┴─────────┐
            │                    │
            ▼                    ▼
    ┌─────────────┐    ┌─────────────┐
    │questions_count│   │  language   │
    │     ?        │   │     ?       │
    └──────┬──────┘    └──────┬──────┘
           │                   │
    ┌──────┴──────┐    ┌──────┴──────┐
    │     Есть    │    │     Есть    │
    └──────┬──────┘    └──────┬──────┘
           │                   │
           ▼                   ▼
    ┌─────────────┐    ┌─────────────┐
    │Использовать │    │Проверить    │
    │  значение   │    │ валидность  │
    └──────┬──────┘    └──────┬──────┘
           │                   │
           │            ┌──────┴──────┐
           │            │  Валидно?   │
           │            └──────┬──────┘
           │                   │
           │            ┌──────┴──────┐
           │            │     Да      │
           │            └──────┬──────┘
           │                   │
           │            ┌──────┴──────┐
           │            │Использовать │
           │            │  значение   │
           │            └──────┬──────┘
           │                   │
           └───────────────────┼──────┐
                               │      │
                               ▼      ▼
                    ┌─────────────────────┐
                    │ questions_count     │
                    │   для сессии       │
                    └─────────────────────┘
```

## ⚠️ Отключенные проверки (ASCII)

```
┌─────────────────────────────────────────────────────────────────┐
│                        Проверки                               │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
              ┌─────────────────────────────────┐
              │        Отключено?               │
              └─────────────────┬───────────────┘
                                │
            ┌───────────────────┴───────────────────┐
            │                                       │
            ▼                                       ▼
    ┌─────────────┐                        ┌─────────────┐
    │     ДА      │                        │     НЕТ     │
    │Пропустить   │                        │Выполнить    │
    │ проверку    │                        │ проверку    │
    └──────┬──────┘                        └──────┬──────┘
           │                                       │
           ▼                                       ▼
    ┌─────────────┐                        ┌─────────────┐
    │Продолжить   │                        │Проверка     │
    │выполнение   │                        │пройдена?    │
    └──────┬──────┘                        └──────┬──────┘
           │                                       │
           │                                ┌──────┴──────┐
           │                                │     Да      │
           │                                └──────┬──────┘
           │                                       │
           │                                ┌──────┴──────┐
           │                                │Продолжить   │
           │                                │выполнение   │
           │                                └──────┬──────┘
           │                                       │
           └───────────────────────────────────────┼──────┐
                                                   │      │
                                                   ▼      ▼
                                        ┌─────────────────────┐
                                        │   Создать сессию    │
                                        └─────────────────────┘
```

## 🎯 Ключевые моменты для фронтендера

1. **Все проверки временно отключены** - можно тестировать без ограничений
2. **Параметры опциональны** - если не указаны, используются значения по умолчанию
3. **Множественные запуски разрешены** - можно создавать несколько сессий
4. **Статус всегда 'in_progress'** - сессия сразу готова к работе
5. **Вопросы инициализируются автоматически** - фронтенд получает готовую сессию

## 🔧 Технические детали

- **Метод:** POST
- **URL:** `/api/surveys/{id}/start/`
- **Аутентификация:** Bearer token в заголовке Authorization
- **Content-Type:** application/json
- **Ответ:** JSON с данными сессии
- **Статус успеха:** 201 Created
- **Транзакционность:** Да (все операции в одной транзакции БД)
